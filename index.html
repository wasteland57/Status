<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Status Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      max-width: 800px;
      margin: 0 auto;
    }
    h1 {
      text-align: center;
      color: #333;
    }
    .person {
      display: flex;
      align-items: center;
      margin: 8px 0;
      padding: 15px;
      background: white;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .person label {
      flex: 1;
      font-weight: bold;
    }
    .status {
      padding: 8px 12px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ddd;
      min-width: 150px;
    }
    .red { background-color: #f8d7da; color: #721c24; }
    .green { background-color: #d4edda; color: #155724; }
    .orange { background-color: #fff3cd; color: #856404; }
    .blue { background-color: #cce5ff; color: #004085; }
    #statusMessage {
      text-align: center;
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
    }
    .error { background: #f8d7da; color: #721c24; }
    .success { background: #d4edda; color: #155724; }
    .loading { background: #fff3cd; color: #856404; }
  </style>
</head>
<body>
  <h1>Status Board</h1>
  <div id="statusMessage" class="loading">Loading statuses...</div>
  <div id="board"></div>

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxrQZSL9MXeAzmgmLHsA0WGKmE2iyEFVJtZfqkKwqb1hsUYU1U_D7HXKPn-HK0EJK-n/exec";
    const people = [
      "Brendan Varga", "Doug Kennedy", "Gerrit Cramer", "Isaac Miller", "John Stebelton",
      "Joe Beattie", "Kayla Plancon", "Kyle Buchner", "Kyle Miller", "Melanie Sobas",
      "Paul Bater", "Renee Kehren", "Rob Mooney", "Scott Sieg", "Steve Rowland", 
      "Will Houser"
    ];

    const statusOptions = [
      { text: "I need work", value: "I need work", class: "orange" },
      { text: "I need help", value: "I need help", class: "red" },
      { text: "I'm good", value: "I'm good", class: "green" },
      { text: "I can do more", value: "I can do more", class: "blue" }
    ];

    const board = document.getElementById("board");
    const statusMessage = document.getElementById("statusMessage");

    function showMessage(text, type = "loading") {
      statusMessage.textContent = text;
      statusMessage.className = type;
    }

    function createStatusDropdown(name, currentStatus) {
      const container = document.createElement("div");
      container.className = "person";

      const label = document.createElement("label");
      label.textContent = name;

      const select = document.createElement("select");
      select.className = "status";
      select.dataset.name = name;

      statusOptions.forEach(option => {
        const optElement = document.createElement("option");
        optElement.value = option.value;
        optElement.textContent = option.text;
        optElement.className = option.class;
        select.appendChild(optElement);
      });

      select.value = currentStatus || "I'm good";
      updateStatusColor(select);

      select.addEventListener("change", () => {
        updateStatusColor(select);
        updateStatus(name, select.value);
      });

      container.appendChild(label);
      container.appendChild(select);
      return container;
    }

    function updateStatusColor(selectElement) {
      selectElement.classList.remove("red", "green", "orange", "blue");
      const selectedOption = statusOptions.find(opt => opt.value === selectElement.value);
      if (selectedOption) {
        selectElement.classList.add(selectedOption.class);
      }
    }

    async function loadStatuses() {
      try {
        showMessage("Loading statuses...", "loading");
        const response = await fetch(SCRIPT_URL);
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.message || "Error from server");
        }

        board.innerHTML = "";
        people.forEach(person => {
          const status = data[person] || "I'm good";
          board.appendChild(createStatusDropdown(person, status));
        });
        
        showMessage("Statuses loaded successfully", "success");
        setTimeout(() => showMessage("", ""), 2000);
      } catch (error) {
        console.error("Error loading statuses:", error);
        showMessage(`Error: ${error.message}`, "error");
        setTimeout(loadStatuses, 5000); // Retry after 5 seconds
      }
    }

    async function updateStatus(name, status) {
      try {
        showMessage(`Updating ${name}'s status...`, "loading");
        const response = await fetch(SCRIPT_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, status })
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const result = await response.json();
        
        if (result.error) {
          throw new Error(result.message || "Error from server");
        }
        
        showMessage(`Updated ${name}'s status to "${status}"`, "success");
        setTimeout(() => showMessage("", ""), 2000);
      } catch (error) {
        console.error("Error updating status:", error);
        showMessage(`Update failed: ${error.message}`, "error");
        setTimeout(() => loadStatuses(), 3000); // Refresh after error
      }
    }

    // Initial load
    loadStatuses();
    
    // Auto-refresh every 15 seconds
    setInterval(loadStatuses, 15000);
  </script>
</body>
</html>