<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Status Tracker</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            color: #333;
            margin: 0;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .person-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        
        .person-card:hover {
            transform: translateY(-2px);
        }
        
        .person-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .status-dropdown {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .status-dropdown:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        /* Status color coding */
        .status-need-help {
            background-color: #ffebee;
            border-color: #f44336;
            color: #c62828;
        }
        
        .status-good {
            background-color: #e8f5e8;
            border-color: #4CAF50;
            color: #2e7d32;
        }
        
        .status-need-work {
            background-color: #fff3e0;
            border-color: #ff9800;
            color: #e65100;
        }
        
        .status-can-do-more {
            background-color: #e3f2fd;
            border-color: #2196F3;
            color: #1565c0;
        }
        
        .last-updated {
            text-align: center;
            color: #666;
            font-size: 12px;
            margin-top: 20px;
            background: white;
            padding: 10px;
            border-radius: 6px;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .error {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin: 10px 0;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            border: 2px solid;
        }
        
        .legend-red {
            background-color: #ffebee;
            border-color: #f44336;
        }
        
        .legend-green {
            background-color: #e8f5e8;
            border-color: #4CAF50;
        }
        
        .legend-orange {
            background-color: #fff3e0;
            border-color: #ff9800;
        }
        
        .legend-blue {
            background-color: #e3f2fd;
            border-color: #2196F3;
        }
        
        .debug-info {
            font-size: 12px;
            color: #666;
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Team Status Tracker</h1>
        <p>Select your current status to keep the team updated</p>
    </div>
    
    <div class="legend">
        <div class="legend-item">
            <div class="legend-color legend-red"></div>
            <span>I need help</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-green"></div>
            <span>I'm good</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-orange"></div>
            <span>I need work</span>
        </div>
        <div class="legend-item">
            <div class="legend-color legend-blue"></div>
            <span>I can do more</span>
        </div>
    </div>
    
    <div id="statusContainer" class="loading">
        Loading team status...
    </div>
    
    <div class="last-updated" id="lastUpdated">
        Last updated: Never
    </div>

    <div class="debug-info" id="debugInfo">
        Debug information will appear here
    </div>

    <script>
        // Configuration - Replace with your Google Apps Script Web App URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwhTlEKlmtIrCnR-8PbhKE8Z9TEECtOY1hmUw68yAUbiLQ41H-DIDDy92rDgJTCCvfs/exec';
        
        const teamMembers = [
            'Brendan Varga', 'Doug Kennedy', 'Gerrit Cramer', 'Isaac Miller',
            'John Stebelton', 'Joe Beattie', 'Kayla Plancon', 'Kyle Buchner',
            'Kyle Miller', 'Melanie Sobas', 'Paul Bater', 'Renee Kehren',
            'Rob Mooney', 'Scott Sieg', 'Steve Will Houser'
        ];
        
        const statusOptions = [
            { value: '', text: 'Select status...', class: '' },
            { value: 'I need help', text: 'I need help', class: 'status-need-help' },
            { value: "I'm good", text: "I'm good", class: 'status-good' },
            { value: 'I need work', text: 'I need work', class: 'status-need-work' },
            { value: 'I can do more', text: 'I can do more', class: 'status-can-do-more' }
        ];
        
        let currentStatuses = {};
        let updateInterval;
        
        // Initialize the application
        function init() {
            logDebug('Initializing application...');
            createStatusCards();
            loadStatuses();
            // Update every 10 seconds
            updateInterval = setInterval(loadStatuses, 10000);
        }
        
        // Create status cards for each team member
        function createStatusCards() {
            const container = document.getElementById('statusContainer');
            container.innerHTML = '';
            container.className = 'status-grid';
            
            teamMembers.forEach(name => {
                const card = document.createElement('div');
                card.className = 'person-card';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'person-name';
                nameDiv.textContent = name;
                
                const select = document.createElement('select');
                select.className = 'status-dropdown';
                select.id = `status-${name.replace(/\s+/g, '-')}`;
                
                statusOptions.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option.value;
                    optionElement.textContent = option.text;
                    select.appendChild(optionElement);
                });
                
                select.addEventListener('change', (e) => {
                    updateStatus(name, e.target.value);
                });
                
                card.appendChild(nameDiv);
                card.appendChild(select);
                container.appendChild(card);
            });
        }
        
        // Load current statuses from Google Sheet
        async function loadStatuses() {
            try {
                logDebug('Loading statuses...');
                const url = `${SCRIPT_URL}?action=getStatuses&cacheBuster=${Date.now()}`;
                logDebug(`Fetching from: ${url}`);
                
                const response = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                logDebug(`Response status: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const contentType = response.headers.get('content-type');
                if (!contentType || !contentType.includes('application/json')) {
                    throw new Error('Response was not JSON');
                }
                
                const data = await response.json();
                logDebug('Parsed response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                if (!data.statuses) {
                    throw new Error('No statuses in response');
                }
                
                currentStatuses = data.statuses;
                logDebug('Current statuses:', currentStatuses);
                updateDisplay();
                updateLastUpdatedTime();
                
                // Clear any existing error messages
                const existingErrors = document.querySelectorAll('.error');
                existingErrors.forEach(error => error.remove());
                
            } catch (error) {
                console.error('Error loading statuses:', error);
                showError(`Failed to load team statuses: ${error.message}`);
            }
        }
        
        // Update display with current statuses
        function updateDisplay() {
            teamMembers.forEach(name => {
                const select = document.getElementById(`status-${name.replace(/\s+/g, '-')}`);
                if (select) {
                    const status = currentStatuses[name] || '';
                    select.value = status;
                    updateSelectStyle(select, status);
                }
            });
        }
        
        // Update select element styling based on status
        function updateSelectStyle(select, status) {
            // Remove all status classes
            select.classList.remove('status-need-help', 'status-good', 'status-need-work', 'status-can-do-more');
            
            // Add appropriate class based on status
            const statusOption = statusOptions.find(opt => opt.value === status);
            if (statusOption && statusOption.class) {
                select.classList.add(statusOption.class);
            }
        }
        
        // Update status for a specific person
        async function updateStatus(name, status) {
            try {
                logDebug(`Updating status for ${name}: ${status}`);
                
                const url = `${SCRIPT_URL}?action=updateStatus&name=${encodeURIComponent(name)}&status=${encodeURIComponent(status)}&cacheBuster=${Date.now()}`;
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    mode: 'cors',
                    cache: 'no-cache'
                });
                
                logDebug(`Response status: ${response.status}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                logDebug('Parsed response:', data);
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                if (data.success) {
                    // Update local status and display
                    currentStatuses[name] = status;
                    const select = document.getElementById(`status-${name.replace(/\s+/g, '-')}`);
                    updateSelectStyle(select, status);
                    updateLastUpdatedTime();
                    logDebug('Status updated successfully!');
                } else {
                    throw new Error('Unexpected response format');
                }
                
            } catch (error) {
                console.error('Error updating status:', error);
                showError(`Failed to update status: ${error.message}`);
                // Revert the select to previous value
                loadStatuses();
            }
        }
        
        // Show error message
        function showError(message) {
            const container = document.getElementById('statusContainer');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.textContent = message;
            container.parentNode.insertBefore(errorDiv, container);
            
            // Remove error after 5 seconds
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
        
        // Update last updated time
        function updateLastUpdatedTime() {
            const lastUpdated = document.getElementById('lastUpdated');
            lastUpdated.textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }
        
        // Log debug information
        function logDebug(message, data) {
            const debugDiv = document.getElementById('debugInfo');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugDiv.insertBefore(entry, debugDiv.firstChild);
            
            if (data) {
                console.log(message, data);
            } else {
                console.log(message);
            }
            
            // Limit to 10 debug entries
            if (debugDiv.children.length > 10) {
                debugDiv.removeChild(debugDiv.lastChild);
            }
        }
        
        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
        
        // Clean up interval when page unloads
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>