<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Status Board</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
    }
    h1 {
      text-align: center;
    }
    .person {
      display: flex;
      align-items: center;
      margin: 8px 0;
      padding: 10px;
      background: white;
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .person label {
      flex: 1;
      font-weight: bold;
    }
    .status {
      padding: 6px;
      font-size: 14px;
      border-radius: 4px;
      border: 1px solid #ccc;
    }
    .red    { background-color: #f8d7da; color: #721c24; }
    .green  { background-color: #d4edda; color: #155724; }
    .orange { background-color: #fff3cd; color: #856404; }
    .blue   { background-color: #cce5ff; color: #004085; }
  </style>
</head>
<body>
  <h1>Status Board</h1>
  <div id="board"></div>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyGCjJwNcSPZLhzTdgoIMhe6-L-p23b9-gdBFYyLOEysuhrpxQKZCKsf98Y2cfmH74s/exec"; // Replace with your actual Apps Script URL
    const people = [
      "Brendan Varga", "Doug Kennedy", "Gerrit Cramer", "Isaac Miller", "John Stebelton",
      "Joe Beattie", "Kayla Plancon", "Kyle Buchner", "Kyle Miller", "Melanie Sobas",
      "Paul Bater", "Renee Kehren", "Rob Mooney", "Scott Sieg", "Steve Rowland", 
      "Will Houser"
    ];

    const options = [
      { text: "I need work",   value: "I need work",   class: "orange" },
      { text: "I need help",   value: "I need help",   class: "red" },
      { text: "I'm good",      value: "I'm good",      class: "green" },
      { text: "I can do more", value: "I can do more", class: "blue" },
    ];

    const board = document.getElementById("board");

    function createDropdown(name, selected) {
      const div = document.createElement("div");
      div.className = "person";

      const label = document.createElement("label");
      label.textContent = name;

      const select = document.createElement("select");
      select.className = "status";
      select.dataset.name = name;

      options.forEach(opt => {
        const option = document.createElement("option");
        option.value = opt.value;
        option.textContent = opt.text;
        option.className = opt.class;
        select.appendChild(option);
      });

      select.value = selected || "I'm good";
      updateColor(select);

      select.addEventListener("change", () => {
        updateColor(select);
        sendUpdate(name, select.value);
      });

      div.appendChild(label);
      div.appendChild(select);
      return div;
    }

    function updateColor(select) {
      select.classList.remove("red", "green", "orange", "blue");
      const colorClass = options.find(o => o.value === select.value)?.class;
      if (colorClass) {
        select.classList.add(colorClass);
      }
    }

    function renderBoard(data = {}) {
      board.innerHTML = "";
      people.forEach(name => {
        const status = data[name] || "I'm good";
        board.appendChild(createDropdown(name, status));
      });
    }

    async function fetchStatuses() {
      try {
        const res = await fetch(scriptURL);
        const data = await res.json();
        renderBoard(data);
      } catch (err) {
        console.error("Failed to load statuses", err);
      }
    }

    async function sendUpdate(name, status) {
      try {
        await fetch(scriptURL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, status }),
        });
      } catch (err) {
        console.error("Failed to update status", err);
      }
    }

    fetchStatuses();
    setInterval(fetchStatuses, 10000); // auto-refresh every 10 seconds
  </script>
</body>
</html>
